---
- hosts: localhost

  collections:
    - cyberark.isp

  tasks:

    - name: Logon to CyberArk Vault using ISP Authentication
      cyberark_authentication:
        api_base_url: "https://baseurl"
        client_id: "username"
        client_secret: "password"

    - name: Show cyberark session
      debug:
        var: cyberark_session

    - name: Application
      cyberark_application:
        api_base_url: "https://baseurl"
        # description: "Application for Partner EdwardTest"
        logging_level: DEBUG
        app_id: "EdwardTest_AppID"
        authentication:
          - AuthType: path
            AuthValue: "/tmp"
            # Comment: "Path for /tmp only"
            IsFolder: True
          - AuthType: osUser
            AuthValue: "Edward/Edward"
        state: present
        cyberark_session: '{{ cyberark_session }}'
      register: cyberark_result

    - name: Show message
      debug:
        var: cyberark_result


    # - name: Safe
    #   cyberark_safe:
    #     api_base_url: "https://baseurl"
    #     description: "Safe for Partner EdwardTest"
    #     logging_level: DEBUG
    #     safe_name: "Partner-EdwardTest"
    #     number_of_days_retention: 7
    #     state: present
    #     cyberark_session: '{{ cyberark_session }}'
    #   register: cyberark_result

    # - name: Show message
    #   debug:
    #     var: cyberark_result

    # - name: Add member
    #   cyberark_safe_member:
    #     api_base_url: "https://baseurl"
    #     logging_level: DEBUG
    #     safe_name: "Partner-EdwardTest"
    #     member_name: "BD Tech"
    #     permissions: 
    #       useAccounts: True
    #       retrieveAccounts: True
    #       listAccounts: True
    #       addAccounts: True
    #       updateAccountContent: True
    #       updateAccountProperties: True
    #       initiateCPMAccountManagementOperations: True
    #       specifyNextAccountContent: True
    #       renameAccounts: True
    #       deleteAccounts: True
    #       unlockAccounts: True
    #       manageSafe: True
    #       manageSafeMembers: True
    #       backupSafe: True
    #       viewAuditLog: True
    #       viewSafeMembers: True
    #       requestsAuthorizationLevel1: True
    #       requestsAuthorizationLevel2: False
    #       accessWithoutConfirmation: True
    #       createFolders: True
    #       deleteFolders: True
    #       moveAccountsAndFolders: True
    #     cyberark_session: '{{ cyberark_session }}'
    #     state: present
    #   register: cyberark_result

    # - name: Show message
    #   debug:
    #     var: cyberark_result

    # - name: Add member
    #   cyberark_safe_member:
    #     api_base_url: "https://baseurl"
    #     logging_level: DEBUG
    #     safe_name: "Partner-EdwardTest"
    #     member_name: "edward@cyberark.cloud.10781"
    #     permissions: 
    #       useAccounts: True
    #       retrieveAccounts: True
    #       listAccounts: True
    #     cyberark_session: '{{ cyberark_session }}'
    #     state: absent
    #   register: cyberark_result

    # - name: Show message
    #   debug:
    #     var: cyberark_result

