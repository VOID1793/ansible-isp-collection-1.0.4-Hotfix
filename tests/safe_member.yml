---
- hosts: localhost

  collections:
    - cyberark.isp

  tasks:

    - name: Logon to CyberArk Vault using ISP Authentication
      cyberark_authentication:
        api_base_url: "https://ispbaseurl"
        client_id: "id"
        client_secret: "secret"

    - name: Show cyberark session
      debug:
        var: cyberark_session

    - name: Application
      cyberark_application:
        api_base_url: "https://apibaseurl"
        # description: "Application for Partner EdwardTest"
        logging_level: DEBUG
        app_id: "xxx_AppID"
        authentication:
          - AuthType: path
            AuthValue: "/tmp"
            IsFolder: True
          - AuthType: path
            AuthValue: "/var/tmp"
            IsFolder: True
            AllowInternalScripts: True
          - AuthType: path
            AuthValue: "/shr/apps"
            IsFolder: True
            AllowInternalScripts: True
          - AuthType: osUser
            AuthValue: "Edward/Edward"
          - AuthType: osUser
            AuthValue: "BizDevTech/Simon"
          - AuthType: hash
            AuthValue: "HASH123332223"
            Comment: "This is the hash for version 1"
          - AuthType: machineAddress
            AuthValue: "2.2.2.2"
            Comment: "Set of address"
          - AuthType: machineAddress
            AuthValue: "3.3.3.3"
          - AuthType: certificateSerialNumber
            AuthValue: "1E8AB650DC258AE3"
            Comment: "Certificate for authentication"
          - AuthType: certificateSerialNumber
            AuthValue: "2E8AB650DC258AE3"
            Comment: "Authentication 2"
          - AuthType: certificateAttr
            Issuer: "CN=Thawte RSA CA 2018,OU=www.digicert.com"
            Subject: ["CN=yourcompany.com","OU=IT","C=IL"]
            SubjectAlternativeName: ["DNS Name=www.example.com","IP Address=1.2.3.4"]
        state: present
        cyberark_session: '{{ cyberark_session }}'
      register: cyberark_result

    - name: Show message
      debug:
        var: cyberark_result


